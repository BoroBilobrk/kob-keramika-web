<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <title>KOB-Keramika â€“ Pro obraÄun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA manifest (ako postoji) -->
  <link rel="manifest" href="manifest.webmanifest">

  <!-- jsPDF za PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Firebase (AUTH + Firestore + Storage) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

  <style>
    :root {
      --bg: #050505;
      --card: #121212;
      --border: #333;
      --accent: #ffffff;
      --accent-soft: #888;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: radial-gradient(circle at top, #202020 0, #000 55%);
      color: #fff;
    }

    header {
      position: sticky;
      top: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }

    header .left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header img.logo {
      height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
    }

    main {
      padding: 12px;
      max-width: 1100px;
      margin: 0 auto 40px auto;
    }

    .card {
      border-radius: 16px;
      padding: 14px 12px;
      margin-bottom: 12px;
      background: radial-gradient(circle at top left, #1c1c1c, #101010);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .view { display: none; }
    .view.active { display: block; }

    h2 { margin-top: 0; }

    label {
      font-size: 13px;
      display: block;
      margin-top: 8px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 3px;
      background: #000;
      color: #fff;
      border: 1px solid #333;
      border-radius: 8px;
      font-size: 13px;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 12px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    button.secondary {
      background: #222;
      color: #fff;
      border: 1px solid #444;
    }

    .btn-small {
      width: auto;
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 10px;
      margin-top: 4px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      font-size: 13px;
    }

    .checkbox-row input {
      width: auto;
      margin-top: 0;
    }

    .section-title {
      margin-top: 4px;
      font-size: 15px;
      font-weight: 700;
      border-bottom: 1px solid #333;
      padding-bottom: 4px;
      margin-bottom: 6px;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .openings-header {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    .opening-card {
      border-radius: 12px;
      padding: 8px 10px;
      margin-bottom: 8px;
      background: #141414;
      border: 1px solid #333;
      font-size: 12px;
    }

    .opening-title {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .opening-meta {
      opacity: 0.85;
    }

    .opening-actions {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #444;
      margin-right: 4px;
      margin-top: 2px;
    }

    #calcOutput {
      font-size: 13px;
      line-height: 1.35;
    }

    .dm-row {
      display: grid;
      grid-template-columns: 1.5fr 1fr 0.7fr auto;
      gap: 6px;
      margin-top: 6px;
      align-items: center;
    }

    .dm-row button {
      width: auto;
      padding: 4px 8px;
      font-size: 11px;
      margin-top: 0;
    }

    .height-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 6px;
      margin-top: 6px;
      align-items: center;
    }

    .height-row button {
      width: auto;
      padding: 4px 8px;
      font-size: 11px;
      margin-top: 0;
    }

    @media (min-width: 800px) {
      .layout-split {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 12px;
      }
    }

    /* Login i arhiva */
    .centered {
      max-width: 420px;
      margin: 30px auto;
    }
    .archive-list-item {
      border-bottom: 1px solid #333;
      padding: 8px 0;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .archive-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .pill {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #444;
      font-size: 11px;
      margin-right: 4px;
    }
  </style>
</head>
<body>

<header>
  <div class="left">
    <img src="logo.png" class="logo" alt="Logo">
    <div>
      <div style="font-weight:bold">KOB-Keramika</div>
      <div style="font-size:12px;opacity:0.8">Pro obraÄun prostorije</div>
    </div>
  </div>
  <div style="font-size:11px;opacity:0.7;" id="userInfo">Nije prijavljen</div>
</header>

<main>

  <!-- LOGIN VIEW -->
  <section id="loginView" class="view active">
    <div class="card centered">
      <h2>Prijava u KOB-Keramika</h2>
      <label>E-mail
        <input type="email" id="loginEmail" placeholder="you@example.com">
      </label>
      <label>Lozinka
        <input type="password" id="loginPassword" placeholder="******">
      </label>
      <button id="btnLogin">ğŸ” Prijava</button>
      <button id="btnRegister" class="secondary">â• Registracija</button>
      <p id="loginError" style="color:#f66;font-size:12px;"></p>
    </div>
  </section>

  <!-- HOME VIEW -->
  <section id="homeView" class="view">
    <div class="card">
      <h2>Å to Å¾eliÅ¡ raditi?</h2>
      <button id="btnOpenAutoCalc">ğŸ“ Automatski obraÄun prostorije</button>
      <button id="btnOpenMeasures">âœï¸ RuÄni unos mjera (u pripremi)</button>
      <button id="btnOpenCosts">ğŸ’° TroÅ¡kovi (postojeÄ‡i modul)</button>
      <button id="btnOpenPrices">ğŸ’¶ Cjenik (postojeÄ‡i modul)</button>
      <button id="btnOpenArchive">ğŸ“‚ Arhiva obraÄuna (Cloud)</button>
      <button id="btnLogout" class="secondary">ğŸšª Odjava</button>
    </div>
  </section>

  <!-- AUTOMATSKI OBRAÄŒUN PROSTORIJE -->
  <section id="autoCalcView" class="view">

    <div class="card">
      <button class="secondary" onclick="showView('homeView')">â† Natrag</button>
      <h2>ğŸ“ Automatski obraÄun prostorije</h2>
      <p style="font-size:13px;opacity:0.8;">
        Dimenzije prostorije + otvori (vrata, prozori, niÅ¡e, geberit, vertikale) â†’ automatski obraÄun poda, zidova,
        hidroizolacije, traka, silikona, sokla, stepenica, lajsni i gerunga. Na kraju se generira detaljna graÄ‘evinska knjiga (PDF),
        CSV za Excel i moÅ¾eÅ¡ spremiti u Cloud.
      </p>
    </div>

    <!-- PODACI O GRADILIÅ TU -->
    <div class="card">
      <div class="section-title">ğŸ— Podaci o gradiliÅ¡tu</div>
      <label>Naziv gradiliÅ¡ta
        <input type="text" id="siteName" placeholder="npr. Stan Novak â€“ Maksimir">
      </label>
      <label>Prostorija
        <input type="text" id="roomName" placeholder="npr. Kupaonica 1">
      </label>
      <div class="two-col">
        <label>Situcija / redni broj
          <input type="text" id="situationNo" placeholder="npr. Situacija 1">
        </label>
        <label>Investitor
          <input type="text" id="investorName" placeholder="npr. Novak Ivan">
        </label>
      </div>
    </div>

    <!-- FORMAT PLOÄŒICE -->
    <div class="card">
      <div class="section-title">ğŸ§± Format ploÄice (obavezno)</div>
      <label>Odaberi format
        <select id="tileFormatSelect">
          <option value="">-- Odaberi format --</option>
          <!-- mali -->
          <option value="10x10">10 Ã— 10 cm</option>
          <option value="15x15">15 Ã— 15 cm</option>
          <option value="20x20">20 Ã— 20 cm</option>
          <option value="20x25">20 Ã— 25 cm</option>
          <option value="20x30">20 Ã— 30 cm</option>
          <option value="25x33">25 Ã— 33 cm</option>
          <option value="25x40">25 Ã— 40 cm</option>
          <option value="25x50">25 Ã— 50 cm</option>
          <!-- srednji -->
          <option value="30x30">30 Ã— 30 cm</option>
          <option value="30x45">30 Ã— 45 cm</option>
          <option value="30x60">30 Ã— 60 cm</option>
          <option value="40x40">40 Ã— 40 cm</option>
          <option value="45x45">45 Ã— 45 cm</option>
          <option value="50x50">50 Ã— 50 cm</option>
          <option value="50x100">50 Ã— 100 cm</option>
          <!-- veliki -->
          <option value="60x60">60 Ã— 60 cm</option>
          <option value="60x120">60 Ã— 120 cm</option>
          <option value="75x75">75 Ã— 75 cm</option>
          <option value="80x80">80 Ã— 80 cm</option>
          <option value="90x90">90 Ã— 90 cm</option>
          <option value="100x100">100 Ã— 100 cm</option>
          <!-- XXL -->
          <option value="100x300">100 Ã— 300 cm</option>
          <option value="120x240">120 Ã— 240 cm</option>
          <option value="120x260">120 Ã— 260 cm</option>
          <option value="120x270">120 Ã— 270 cm</option>
          <option value="120x280">120 Ã— 280 cm</option>
          <option value="120x300">120 Ã— 300 cm</option>
          <option value="160x320">160 Ã— 320 cm</option>
          <option value="162x324">162 Ã— 324 cm</option>
          <!-- ruÄni -->
          <option value="custom">RuÄni unos</option>
        </select>
      </label>
      <div id="tileCustomFields" style="display:none;">
        <div class="two-col">
          <label>Å irina ploÄice (cm)
            <input type="text" id="tileW" placeholder="npr. 60">
          </label>
          <label>Duljina ploÄice (cm)
            <input type="text" id="tileH" placeholder="npr. 120">
          </label>
        </div>
      </div>
      <p style="font-size:11px;opacity:0.7;margin-top:4px;">
        Bez odabranog formata ploÄice obraÄun se neÄ‡e pokrenuti.
      </p>
    </div>

    <div class="layout-split">

      <!-- LIJEVA STRANA â€“ UNOS -->
      <div>

        <div class="card">
          <div class="section-title">ğŸ“ Osnovne dimenzije prostorije</div>

          <label>Duljina D (m)
            <input type="text" id="dimD" placeholder="npr. 4,20">
          </label>

          <label>Å irina Å  (m)
            <input type="text" id="dimS" placeholder="npr. 3,10">
          </label>

          <label>Visina V (m)
            <input type="text" id="dimV" placeholder="npr. 2,65">
          </label>
        </div>

        <div class="card">
          <div class="section-title">â˜‘ Å to se raÄuna?</div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkPod">
            <label for="chkPod">Pod (mÂ²)</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkZidovi">
            <label for="chkZidovi">Zidovi (bruto â€“ samo vrata se odbijaju)</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkHidroPod">
            <label for="chkHidroPod">Hidroizolacija â€“ pod</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkHidroTus">
            <label for="chkHidroTus">Hidroizolacija â€“ tuÅ¡ zona</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkHidroTraka">
            <label for="chkHidroTraka">Hidro traka (pod + prozor + niÅ¡a)</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkSilikon">
            <label for="chkSilikon">Silikon (bez vrata)</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkSokl">
            <label for="chkSokl">Sokl</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkStepenice">
            <label for="chkStepenice">Stepenice</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkLajsne">
            <label for="chkLajsne">Lajsne</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkGerung">
            <label for="chkGerung">Gerung</label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="chkDodatne">
            <label for="chkDodatne">Dodatne mjere (+/âˆ’)</label>
          </div>
        </div>

        <!-- TuÅ¡ zona -->
        <div class="card" id="cardTus" style="display:none;">
          <div class="section-title">ğŸš¿ TuÅ¡ zona</div>
          <div class="two-col">
            <label>Duljina tuÅ¡a d (m)
              <input type="text" id="tusD" placeholder="npr. 0,90">
            </label>
            <label>Å irina tuÅ¡a Å¡ (m)
              <input type="text" id="tusS" placeholder="npr. 1,45">
            </label>
          </div>
          <label>Visina tuÅ¡a v (m) â€“ po defaultu glavna visina
            <input type="text" id="tusV" placeholder="prazno = visina prostorije">
          </label>
          <p style="font-size:11px;opacity:0.7;margin-top:4px;">
            Hidro tuÅ¡ = (2Ã—d + Å¡) Ã— v
          </p>
        </div>

        <!-- Silikon â€“ viÅ¡estruke visine -->
        <div class="card" id="cardSilikon" style="display:none;">
          <div class="section-title">ğŸ§¼ Silikon</div>
          <p style="font-size:12px;opacity:0.8;">
            Formula: (2Ã—D + 2Ã—Å  + 4Ã—V) + âˆ‘(dodatne visine) + rubovi svih otvora osim vrata.
          </p>
          <div id="silHeightsContainer"></div>
          <button type="button" class="btn-small secondary" id="btnAddHeight">â• Dodaj visinu</button>
        </div>

        <!-- Sokl -->
        <div class="card" id="cardSokl" style="display:none;">
          <div class="section-title">ğŸ“ Sokl â€“ korekcije</div>
          <label>Odbijanje sokla (m)
            <input type="text" id="soklMinus" placeholder="0">
          </label>
          <label>Dodatno sokla (m)
            <input type="text" id="soklPlus" placeholder="0">
          </label>
          <p style="font-size:11px;opacity:0.7;margin-top:4px;">
            Sokl = 2Ã—(D+Å ) âˆ’ odbijanje + dodatno
          </p>
        </div>

        <!-- Stepenice -->
        <div class="card" id="cardStepenice" style="display:none;">
          <div class="section-title">ğŸªœ Stepenice</div>
          <label>Å irina stepenice (m)
            <input type="text" id="stepWidth" placeholder="npr. 1,00">
          </label>
          <label>Broj stepenica (kom)
            <input type="text" id="stepCount" placeholder="npr. 5">
          </label>
          <label>Vrsta obraÄuna
            <select id="stepMode">
              <option value="duzni">DuÅ¾ni metri (Å  Ã— kom)</option>
              <option value="komada">Broj komada</option>
            </select>
          </label>
        </div>

        <!-- Lajsne -->
        <div class="card" id="cardLajsne" style="display:none;">
          <div class="section-title">ğŸ”¹ Lajsne</div>
          <p style="font-size:12px;opacity:0.8;">
            Ukupno lajsni = ruÄni metri + rubovi oznaÄenih elemenata.
          </p>
          <label>Lajsna 1 (m)
            <input type="text" id="l1" placeholder="0">
          </label>
          <label>Lajsna 2 (m)
            <input type="text" id="l2" placeholder="0">
          </label>
          <label>Lajsna 3 (m)
            <input type="text" id="l3" placeholder="0">
          </label>
          <div class="section-title">Lajsne na elementima</div>
          <div class="checkbox-row"><input type="checkbox" id="lProzor"><label for="lProzor">Prozori</label></div>
          <div class="checkbox-row"><input type="checkbox" id="lNisa"><label for="lNisa">NiÅ¡e</label></div>
          <div class="checkbox-row"><input type="checkbox" id="lGeberit"><label for="lGeberit">Geberit</label></div>
          <div class="checkbox-row"><input type="checkbox" id="lVert"><label for="lVert">Vertikale</label></div>
        </div>

        <!-- Gerung -->
        <div class="card" id="cardGerung" style="display:none;">
          <div class="section-title">ğŸ”ª Gerung</div>
          <p style="font-size:12px;opacity:0.8;">
            Ukupno gerunga = ruÄni metri + rubovi oznaÄenih elemenata.
          </p>
          <label>Gerung 1 (m)
            <input type="text" id="g1" placeholder="0">
          </label>
          <label>Gerung 2 (m)
            <input type="text" id="g2" placeholder="0">
          </label>
          <label>Gerung 3 (m)
            <input type="text" id="g3" placeholder="0">
          </label>
          <div class="section-title">Gerung na elementima</div>
          <div class="checkbox-row"><input type="checkbox" id="gProzor"><label for="gProzor">Prozori</label></div>
          <div class="checkbox-row"><input type="checkbox" id="gNisa"><label for="gNisa">NiÅ¡e</label></div>
          <div class="checkbox-row"><input type="checkbox" id="gGeberit"><label for="gGeberit">Geberit</label></div>
          <div class="checkbox-row"><input type="checkbox" id="gVert"><label for="gVert">Vertikale</label></div>
        </div>

        <!-- Dodatne mjere -->
        <div class="card" id="cardDodatne" style="display:none;">
          <div class="section-title">â•â– Dodatne mjere</div>
          <p style="font-size:12px;opacity:0.8;">
            MoÅ¾eÅ¡ dodati do 10 polja kao + ili âˆ’ mjera. Ukupno se zatim dodaje/oduzima od oznaÄenih kategorija.
          </p>
          <div id="dmContainer"></div>
          <button type="button" class="btn-small secondary" id="btnAddDmRow">â• Dodaj mjeru</button>

          <div class="section-title">Gdje se primjenjuje?</div>
          <div class="checkbox-row"><input type="checkbox" id="dmPod"><label for="dmPod">Pod</label></div>
          <div class="checkbox-row"><input type="checkbox" id="dmZidovi"><label for="dmZidovi">Zidovi</label></div>
          <div class="checkbox-row"><input type="checkbox" id="dmHidro"><label for="dmHidro">Hidro pod</label></div>
          <div class="checkbox-row"><input type="checkbox" id="dmSil"><label for="dmSil">Silikon</label></div>
          <div class="checkbox-row"><input type="checkbox" id="dmTraka"><label for="dmTraka">Hidro traka</label></div>
          <div class="checkbox-row"><input type="checkbox" id="dmSokl"><label for="dmSokl">Sokl</label></div>
        </div>

        <!-- Gumbi za izraÄun -->
        <div class="card">
          <button id="btnCalcNow">ğŸ” IzraÄunaj sve</button>
          <button id="btnAddRoomToBook" class="secondary">â• Dodaj prostoriju u graÄ‘evinsku knjigu</button>
          <button id="btnExportPdfAuto" class="secondary">ğŸ“„ PDF â€“ graÄ‘evinska knjiga</button>
          <button id="btnExportCsvAuto" class="secondary">ğŸ“‘ CSV â€“ Excel export</button>
          <button id="btnSaveCloud" class="secondary">â˜ï¸ Spremi u Cloud (podatci + PDF)</button>
          <p id="gkRoomsInfo" style="margin-top:8px;font-size:11px;opacity:0.85;"></p>
        </div>

      </div>

      <!-- DESNA STRANA â€“ OTVORI + REZULTATI -->
      <div>

        <!-- Otvori kao kartice -->
        <div class="card">
          <div class="section-title">ğŸ§± Otvori (vrata, prozori, niÅ¡e, geberit, vertikale)</div>
          <p style="font-size:12px;opacity:0.8;">
            Vrata se odbijaju od zidova, ali ne ulaze u silikon. Prozori i niÅ¡e ulaze u hidro traku i silikon.
            Geberit i vertikale sluÅ¾e za lajsne i gerung.
          </p>
          <div class="openings-header">
            <button id="btnAddDoor"     class="btn-small">â• Vrata</button>
            <button id="btnAddWindow"   class="btn-small">â• Prozor</button>
            <button id="btnAddNiche"    class="btn-small">â• NiÅ¡a</button>
            <button id="btnAddGeberit"  class="btn-small">â• Geberit</button>
            <button id="btnAddVert"     class="btn-small">â• Vertikala</button>
            <button id="btnAddCustom"   class="btn-small">â• Custom otvor</button>
          </div>
          <div id="openingsList"></div>
        </div>

        <!-- Rezultati -->
        <div class="card" id="calcResult" style="display:none;">
          <h3>ğŸ“Š Rezultati obraÄuna</h3>
          <div id="calcOutput"></div>
        </div>

      </div>

    </div>
  </section>

  <!-- ARHIVA VIEW -->
  <section id="archiveView" class="view">
    <div class="card">
      <button class="secondary" onclick="showView('homeView')">â† Natrag</button>
      <h2>ğŸ“‚ Arhiva obraÄuna (Cloud)</h2>
      <p style="font-size:12px;opacity:0.8;">
        Popis svih spremljenih obraÄuna. Svi prijavljeni korisnici vide sve zapise.
      </p>
    </div>
    <div class="card">
      <div id="archiveList"></div>
    </div>
  </section>

</main>


  <!-- Aplikacijski skripte (bez inline koda, bez top-level await) -->
  <script src="./JS/firebase.js"></script>
  <script src="./JS/calc.js"></script>
  <script src="./JS/app.js"></script>
  <script src="./JS/cloud.js"></script>
  <script src="./JS/ocr.js"></script>


</body>
</html>
