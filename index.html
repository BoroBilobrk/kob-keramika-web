<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KOB-Keramika â€“ Pro obraÄun prostorije</title>

  <link rel="stylesheet" href="CSS/main.css">
</head>
<body>

<header>
  <div class="left">
    <img src="logo.png" class="logo" alt="Logo">
    <div>
      <div class="brand">KOB-Keramika</div>
      <div class="subtitle">Pro obraÄun prostorije</div>
    </div>
  </div>
  <div id="userInfo" class="user-info">Nije prijavljen</div>
</header>

<main>

  <!-- ===================== HOME ===================== -->
  <section id="homeView" class="view" style="display:block;">
    <h2>Å to Å¾eliÅ¡ raditi?</h2>

    <div class="card">
      <button id="btnOpenAutoCalc" class="menu-btn">ğŸ“ Automatski obraÄun prostorije</button>
      <button id="btnOpenMeasures" class="menu-btn">âœï¸ RuÄni unos mjera</button>
      <button id="btnOpenCosts" class="menu-btn">ğŸ’° TroÅ¡kovi</button>
      <button id="btnOpenPrices" class="menu-btn">ğŸ“’ Cjenik</button>

      <!-- NOVO -->
      <button id="btnOpenTroskovnikUpload" class="menu-btn">ğŸ“¥ UÄitavanje troÅ¡kovnika</button>
      <button id="btnOpenTroskovnikCalc" class="menu-btn">ğŸ“Š ObraÄun po troÅ¡kovniku</button>

      <button id="btnOpenArchive" class="menu-btn">ğŸ“‚ Arhiva obraÄuna</button>
    </div>
  </section>


  <!-- =============== UÄŒITAVANJE TROÅ KOVNIKA (NOVO) =============== -->
  <section id="troskovnikUploadView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ“¥ UÄitavanje troÅ¡kovnika</h2>

    <div class="card">
      <p class="hint">
        UÄitaj troÅ¡kovnik iz Excel-a (XLSX/CSV) ili PDF-a.
        Nakon uÄitavanja, stavke Ä‡e biti dostupne u modulu â€œObraÄun po troÅ¡kovnikuâ€.
      </p>

      <input id="troskovnikFile" type="file" accept=".xlsx,.xls,.csv,.pdf">
      <button id="btnLoadTroskovnik">ğŸ“¥ UÄitaj troÅ¡kovnik</button>

      <div id="troskovnikUploadStatus" class="hint" style="margin-top:10px;"></div>
    </div>

    <div class="card">
      <h3>ğŸ“„ Pregled uÄitanih stavki</h3>
      <div id="troskovnikPreview" class="hint">Nema uÄitanih stavki.</div>
    </div>
  </section>


  <!-- =============== OBRAÄŒUN PO TROÅ KOVNIKU (NOVO) =============== -->
  <section id="troskovnikCalcView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ“Š ObraÄun po troÅ¡kovniku</h2>

    <div class="card">
      <p class="hint">
        Odaberi stavke iz troÅ¡kovnika (kvaÄice), unesi podatke o gradiliÅ¡tu i dimenzije prostorije.
        Ovaj modul koristi istu logiku mjerenja kao â€œAutomatski obraÄunâ€, ali prema stavkama iz troÅ¡kovnika.
      </p>
    </div>

    <div class="card">
      <h3>âœ… Stavke iz troÅ¡kovnika</h3>
      <div id="troskovnikItemsList" class="hint">UÄitaj troÅ¡kovnik da se pojave stavke.</div>
    </div>

    <div class="card">
      <button id="btnCalcFromTroskovnik">ğŸ” IzraÄunaj po troÅ¡kovniku</button>
      <button id="btnExportPdfTroskovnik" class="secondary">ğŸ“„ PDF â€“ po troÅ¡kovniku</button>
      <button id="btnSaveCloudTroskovnik" class="secondary">â˜ï¸ Spremi u Cloud</button>
    </div>

    <div class="card" id="troskovnikResult" style="display:none;">
      <h3>ğŸ“Š Rezultat</h3>
      <div id="troskovnikOutput"></div>
    </div>
  </section>


  <!-- =============== AUTOMATSKI OBRAÄŒUN =============== -->
  <section id="autoCalcView" class="view">

    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ“ Automatski obraÄun prostorije</h2>

    <!-- PODACI O GRADILIÅ TU -->
    <div class="card">
      <h3>ğŸ—ï¸ Podaci o gradiliÅ¡tu</h3>

      <!-- NOVO: oznaka gradiliÅ¡ta -->
      <input id="siteCode" placeholder="Oznaka gradiliÅ¡ta (siteCode) (npr. AUR-001)">

      <input id="siteName" placeholder="Naziv gradiliÅ¡ta (npr. Hotel Aurora)">
      <input id="roomName" placeholder="Naziv prostorije (npr. Kupaonica 101)">
      <input id="situationNo" placeholder="Broj situacije (npr. S-12)">
      <input id="investorName" placeholder="Investitor (npr. Jadranka d.d.)">
      <input id="contractValue" placeholder="Ugovorena vrijednost gradiliÅ¡ta (EUR), npr. 25000">

      <!-- NOVO: prethodne situacije (puni JS iz Clouda) -->
      <input id="prevSituations" placeholder="Prethodne situacije ukupno (EUR) â€“ automatski iz Clouda" readonly>

      <h4>Prostorije na gradiliÅ¡tu</h4>
      <div class="rooms-actions">
        <button id="btnAddRoomToSite">â• Dodaj / aÅ¾uriraj ovu prostoriju</button>
        <button id="btnClearRooms" class="secondary">ğŸ§¹ OÄisti listu</button>
      </div>
      <div id="roomsList"></div>
    </div>

    <!-- FORMAT PLOÄŒICA -->
    <div class="card">
      <h3>ğŸ§± Format ploÄica</h3>
      <select id="tileFormatSelect">
        <option value="">-- odaberi --</option>
        <option value="30x60">30 Ã— 60 cm</option>
        <option value="60x60">60 Ã— 60 cm</option>
        <option value="90x90">90 Ã— 90 cm</option>
        <option value="120x120">120 Ã— 120 cm</option>
        <option value="60x120">60 Ã— 120 cm</option>
        <option value="100x300">100 Ã— 300 cm</option>
        <option value="custom">PrilagoÄ‘eno</option>
      </select>

      <div id="tileCustomFields" style="display:none; margin-top:10px;">
        <input id="tileW" placeholder="Å irina ploÄice (cm)">
        <input id="tileH" placeholder="Visina ploÄice (cm)">
      </div>
    </div>

    <!-- DIMENZIJE -->
    <div class="card">
      <h3>ğŸ“ Dimenzije prostorije</h3>
      <input id="dimD" placeholder="DuÅ¾ina (m), npr. 3,20">
      <input id="dimS" placeholder="Å irina (m), npr. 2,40">
      <input id="dimV" placeholder="Visina (m), npr. 2,60">
    </div>

    <!-- =================== HIDRO TUÅ  (NOVO) =================== -->
    <div class="card">
      <h3>ğŸš¿ Hidro tuÅ¡ â€“ mjere</h3>
      <p class="hint">
        Unesi mjere tuÅ¡a kao (a + b) Ã— visina.
        U obraÄunu se zbraja u hidroizolaciju, a za hidro traku dodaje se (a + b + visina) prema dogovoru.
      </p>

      <div class="height-row">
        <input id="tusA" placeholder="a (m), npr. 1,20">
        <input id="tusB" placeholder="b (m), npr. 0,80">
      </div>

      <div style="margin-top:10px;">
        <input id="tusV" placeholder="visina (m), npr. 2,10">
      </div>

      <div id="tusHint" class="hint" style="margin-top:8px;"></div>
    </div>

    <!-- OTVORI ISPOD DIMENZIJA -->
    <div class="card">
      <h3>ğŸ§± Otvori (vrata, prozori, niÅ¡e, geberit, vertikale)</h3>
      <p class="hint">
        Vrata se odbijaju od zidova, prozori i niÅ¡e ulaze u hidro i silikon. Geberit i vertikale sluÅ¾e za lajsne / gerung.
      </p>

      <div class="openings-header">
        <button id="btnAddDoor" class="btn-small">â• Vrata</button>
        <button id="btnAddWindow" class="btn-small">â• Prozor</button>
        <button id="btnAddNiche" class="btn-small">â• NiÅ¡a</button>
        <button id="btnAddGeberit" class="btn-small">â• Geberit</button>
        <button id="btnAddVert" class="btn-small">â• Vertikala</button>
        <button id="btnAddCustom" class="btn-small">â• Custom</button>
      </div>
      <div id="openingsList"></div>
    </div>

    <!-- =================== STUBIÅ TE (NOVO) =================== -->
    <div class="card">
      <h3>ğŸªœ StubiÅ¡te â€“ mjere</h3>
      <p class="hint">
        Unesi duÅ¾inu jedne stepenice i broj komada. ObraÄun: duÅ¾ina Ã— komada.
      </p>

      <input id="stubeDuzina" placeholder="DuÅ¾ina jedne stepenice (m), npr. 1,10">
      <input id="stubeKom" placeholder="Broj stepenica (kom), npr. 12">

      <div id="stubeHint" class="hint" style="margin-top:8px;"></div>
    </div>

    <!-- STAVKE -->
    <div class="card">
      <h3>ğŸ“‹ Stavke</h3>

      <div class="checkbox-row">
        <input type="checkbox" id="chkPod">
        <label for="chkPod">RaÄunaj pod</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkZidovi">
        <label for="chkZidovi">RaÄunaj zidove</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkHidro">
        <label for="chkHidro">Hidroizolacija (pod + tuÅ¡)</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkHidroTraka">
        <label for="chkHidroTraka">Hidroizolacijska traka</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkSilikon">
        <label for="chkSilikon">Silikon</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkSokl">
        <label for="chkSokl">Sokl</label>
      </div>

      <!-- ODVOJENE LAJSNE I GERUNG -->
      <div class="checkbox-row">
        <input type="checkbox" id="chkLajsne">
        <label for="chkLajsne">Lajsne</label>
      </div>
      <div class="checkbox-row">
        <input type="checkbox" id="chkGerung">
        <label for="chkGerung">Gerung</label>
      </div>

      <div class="checkbox-row">
        <input type="checkbox" id="chkDodatne">
        <label for="chkDodatne">UkljuÄi dodatne mjere</label>
      </div>

      <!-- OVO OSTAVLJAMO zbog postojeÄ‡e logike -->
      <div class="checkbox-row">
        <input type="checkbox" id="chkStepenice">
        <label for="chkStepenice">Stepenice</label>
      </div>

      <div id="stepeniceInputs" style="display:none; margin-top:10px;">
        <input id="stepM" placeholder="DuÅ¾ina stepenica (m)">
        <input id="stepKom" placeholder="Broj stepenica (kom)">
      </div>
    </div>

    <!-- DODATNE MJERE -->
    <div class="card">
      <h3>â• Dodatne mjere (+/âˆ’)</h3>
      <button id="btnAddDm" class="secondary btn-small">â• Dodaj mjeru</button>
      <div id="dmContainer"></div>
    </div>

    <!-- GUMBI ZA IZRAÄŒUN -->
    <div class="card">
      <button id="btnCalcNow">ğŸ” IzraÄunaj sve</button>
      <button id="btnExportPdfAuto" class="secondary">ğŸ“„ PDF â€“ graÄ‘evinska knjiga</button>
      <button id="btnExportCsvAuto" class="secondary">ğŸ“‘ CSV â€“ Excel export</button>
      <button id="btnSaveCloud" class="secondary">â˜ï¸ Spremi u Cloud (podatci + PDF)</button>
    </div>

    <!-- REZULTATI -->
    <div class="card" id="calcResult" style="display:none;">
      <h3>ğŸ“Š Rezultati obraÄuna</h3>
      <div id="calcOutput"></div>
    </div>

  </section>


  <!-- =============== RUÄŒNI UNOS MJERA =============== -->
  <section id="measuresView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>âœï¸ RuÄni unos mjera</h2>

    <div class="card">
      <table class="table">
        <thead>
        <tr>
          <th>Naziv</th>
          <th>Mjera</th>
          <th>Jed.</th>
        </tr>
        </thead>
        <tbody id="manualMeasuresBody">
        <tr>
          <td><input type="text" placeholder="Pod"></td>
          <td><input type="text" placeholder="12,50"></td>
          <td><input type="text" placeholder="m2"></td>
        </tr>
        </tbody>
      </table>
      <button id="btnAddManualMeasure" class="btn-small secondary">â• Dodaj red</button>
    </div>
  </section>


  <!-- =============== TROÅ KOVI =============== -->
  <section id="costsView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ’° TroÅ¡kovi</h2>

    <div class="card">
      <input id="costHourly" placeholder="Cijena rada po satu (EUR), npr. 15">
      <input id="costHours" placeholder="Broj sati, npr. 8">
      <input id="costOther" placeholder="Ostali troÅ¡kovi (gorivo, cestarina, materijalâ€¦) (EUR)">
      <button id="btnCalcCosts">ğŸ” IzraÄunaj troÅ¡ak</button>
      <div id="costsOutput" class="hint"></div>
    </div>
  </section>


  <!-- =============== CJENIK =============== -->
  <section id="pricesView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ“’ Cjenik</h2>

    <div class="card">
      <p class="hint">
        Ovdje ruÄno upiÅ¡i cijene po jedinici rada (ovisno o formatu ploÄica).
        Te cijene koristi automatski obraÄun i PDF.
      </p>

      <div class="price-row">
        <label>Pod (EUR / mÂ²)</label>
        <input id="pricePod" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Zidovi (EUR / mÂ²)</label>
        <input id="priceZidovi" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Hidro pod (EUR / mÂ²)</label>
        <input id="priceHidroPod" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Hidro tuÅ¡ (EUR / mÂ²)</label>
        <input id="priceHidroTus" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Hidro traka (EUR / m)</label>
        <input id="priceHidroTraka" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Silikon (EUR / m)</label>
        <input id="priceSilikon" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Sokl (EUR / m)</label>
        <input id="priceSokl" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Lajsne (EUR / m)</label>
        <input id="priceLajsne" placeholder="0,00">
      </div>
      <div class="price-row">
        <label>Gerung (EUR / m)</label>
        <input id="priceGerung" placeholder="0,00">
      </div>

      <button id="btnSavePrices">ğŸ’¾ Spremi cjenik</button>
    </div>
  </section>


  <!-- =============== ARHIVA =============== -->
  <section id="archiveView" class="view">
    <button class="btn-back" data-target="homeView">â† Natrag</button>
    <h2>ğŸ“‚ Arhiva obraÄuna (Cloud)</h2>

    <div class="card">
      <p class="hint">Popis svih spremljenih obraÄuna.</p>
    </div>
    <div class="card">
      <div id="archiveList"></div>
    </div>
  </section>

</main>

<!-- JS PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- FIREBASE v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<!-- NAÅ  MODULARNI APP -->
<script type="module" src="JS/app.js"></script>

</body>
</html>
